#!/bin/bash
#
# Kilo browser desktop wrapper
# Based on Chromium desktop wrapper

set -e

# Absolute path of this wrapper
WRAPPER="$(readlink -f "$0")"
HERE="$(dirname "$WRAPPER")"

# Let the binary know it was launched via wrapper
export CHROME_WRAPPER="$WRAPPER"
export CHROME_DEVEL_SANDBOX=/opt/kilo/chrome_sandbox

# Prefer bundled xdg utils only if system ones are missing
if ! command -v xdg-settings >/dev/null 2>&1; then
  export PATH="$HERE:$PATH"
else
  # Ensure mimeapps.list exists (some xdg-mime versions require it)
  xdg_app_dir="${XDG_DATA_HOME:-$HOME/.local/share/applications}"
  mkdir -p "$xdg_app_dir"
  [ -f "$xdg_app_dir/mimeapps.list" ] || touch "$xdg_app_dir/mimeapps.list"
fi

# Optional channel branding (can be removed safely)
export CHROME_VERSION_EXTRA="stable"

# Disable GNOME crash dialog interception
export GNOME_DISABLE_CRASH_DIALOG=SET_BY_KILO

# Sanitize stdio (Chromium security recommendation)
exec < /dev/null
exec > >(exec cat)
exec 2> >(exec cat >&2)

# Launch real binary
exec "$HERE/kilo" "$@"
